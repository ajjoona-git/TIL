## CNN (Convolutional Neural Network)

### FCN (Fully-Connected Layer, 완전 연결층)

- 입력을 받아서 출력으로 변환하는 신경망의 기본 모듈

![FCN](../images/cnn-basics_1.png)

### 합성곱 레이어 (Convolution Layer)

- 입력 이미지를 필터와 연산하여 특징 맵(Feature Map)을 뽑아내는 모듈
- 1차원 구조로 변환하는 FCN과 달리, 3차원 구조를 그대로 보존하면서 연산한다.
- Convolution(컨볼루션): 필터를 이미지 상에서 **이동**시키면서 **내적**을 반복 수행 후, 내적으로 구한 모든 값을 출력으로 제공한다.

![합성곱](../images/cnn-basics_2.png)

- **반드시 필터의 채널과 입력의 채널이 동일해야 한다.**
- 활성화 맵 (Activation Map): 필터의 이동 경로를 따라 모든 연산 값을 모아 출력한 값

![합성곱](../images/cnn-basics_3.png)

![합성곱](../images/cnn-basics_4.png)

- 입력 대비 출력의 공간 해상도가 줄어든다.
    - 출력 해상도 = 입력 해상도 - 필터 해상도 + 1
- 입출력 해상도를 유지하고 싶다면 ‘패딩’ 활용
    - 출력값 중 정의되지 않은 경우, 0 또는 가장 가까운 출력값으로 대체한다.

### Convolution Layer

![합성곱 레이어](../images/cnn-basics_5.png)

**입력 (Input)**

- `N` (Batch Size): 한 번에 처리하는 이미지의 개수
    - 여러 장의 이미지를 동시에 처리하여 학습 효율을 높인다.
- `C_in` (Input Channels): 입력 이미지의 채널 수
    - 흑백 이미지는 채널이 1개
    - 컬러 이미지(RGB)는 Red, Green, Blue 3개의 채널
- `H` (Height): 입력 이미지의 세로 길이 (높이), 픽셀 단위
- `W` (Width): 입력 이미지의 가로 길이 (너비), 픽셀 단위

**필터 (Filter / Kernel) & 편향 (Bias)**

- `C_out` (Output Channels): 출력 피처 맵(Feature Map)의 채널 수
    - 컨볼루션 레이어에서 사용하는 필터(filter)의 개수와 같다.
    - 각 필터는 이미지에서 서로 다른 특징(예: 윤곽선, 질감 등)을 추출하는 역할을 한다.
- `K_h` (Kernel Height): 필터의 세로 길이
- `K_w` (Kernel Width): 필터의 가로 길이

**출력 (Output)**

- `H'` (Output Height): 컨볼루션 연산 후 출력되는 피처 맵의 세로 길이
- `W'` (Output Width): 컨볼루션 연산 후 출력되는 피처 맵의 가로 길이

### CNN 구조의 장점

- 지역적인 특징 학습에 특화: 작은 필터로 학습하여 패턴/경계선 특징 포착에 용이하다.
- 파라미터 효율성 우수: 지역적 특징 추출 시 이미지 블록별 가중치를 공유하여 연산량을 절감한다.
- 위치 변화와 노이즈에 견고: 풀링/스트라이드 합성곱이 세부 차이는 줄이고 이미지 전체 의미에 집중하게 한다.
- 이미지 분류/탐지 등 이미지 기반의 과업에서 표준 모델로 활약


### CNN의 한계

- 순차적(sequential) 데이터의 순서 정보(텍스트, 음성의 시간 흐름 등)를 반영하기 어렵다.
    - 같은 단어여도 순서가 의미를 바꾼다면?
        - “약을 먹고 잠을 자고” vs “잠을 자고 약을 먹고”
    - 단어 조합은 같지만 순서가 바뀐다면?
        - “I am a boy not a girl” vs “I am a girl not a boy”
- CNN은 국소적(로컬) 특징 추출에 강하지만 이미지나 문장에서 멀리 떨어진 요소 간의 관계를 잘 학습하지 못한다.
    - 이미지에 멀리 있지만 반복되는 패턴이 있는 경우
- 이미지 전체의 정보를 압축(예: 라벨)에 효과적이지만 위치 정보는 손실된다. (Pooling/Stride 효과)
    - 픽셀 단위 복원(예: 세그멘테이션)이나 영상 생성(생성, 편집, 개선 등) 문제를 다루기 위한 새로운 구조가 필요하다.

## CNN 모델 구조
![CNN 핵심 구조](../images/cnn-basics_11.png)

### 중첩

![중첩](../images/cnn-basics_6.png)

- 모델 상수 (파라미터)를 증가시키면?
- 선형 블록의 중첩은 결국 하나의 선형 블록으로 치환할 수 있다.
- 비선형 블록 (Conv[Linear] + ReLU[비선형 변환])

### 필터 시각화

- 학습된 필터 시각화를 통해 각 모델(구조)가 학습한 정보를 이해할 수 있다.

![필터 시각화](../images/cnn-basics_7.png)

- CNN: 이미지의 로컬 특징을 잘 뽑아낸다.
    - Gabor 필터

### 수용영역 (Receptive Field)

- **수용영역**: CNN이 이미지를 처리하면서 한 번에 볼 수 있는 영역의 크기
    - 네트워크의 시야
- CNN 레이어는 지역 정보(local, 이미지의 작은 부분)를 추출하는 데 유리하다.
- 이미지를 활용하는 다양한 작업에서 이미지 전체 (예: 맥락) 의미 파악이 필요하다.
- 일반적으로 **네트워크가 깊어질수록 수용영역도 넓어진다.**
    - 폭 넓은 맥락을 이해할 수 있다.
- 고해상도 이미지 처리 시, 많은 레이어를 통과해야 한다.
    - 연산, 비용, 학습 가능성을 고려할 때 비실용적이다.
    - 입력 사이즈를 줄여 모델에 입력해 해결한다.

![수용영역](../images/cnn-basics_8.png)

### 풀링

- 효율적 연산: CNN 레이어의 출력을 줄여 연산 효율성을 확보한다.
    - 입력 크기가 줄면 CNN의 연산량이 크게 줄어든다.
    - 출력 해상도는 낮아진다. (정보 손실)
- 위치 변화 강건성: 입력 내 객체 위치가 다소 변해도 동일한 출력을 제공한다.
    - 사실상 저해상도 정보에 근거하여 작업을 수행하므로 몇 화소 이동은 무시된다.

![폴링](../images/cnn-basics_9.png)

- **맥스풀링**: 정해진 커널 사이즈(예: 2x2)로 이미지를 나누어 각 영역 내 **가장 큰 값**을 선택하는 연산
    - 가장 두드러진 특징(feature)을 추출하여 유지한다.
        - 컨볼루션 레이어를 통과한 피처 맵(feature map)의 값은 해당 위치에서 특정 특징(예: 윤곽선, 질감, 특정 모양 등)이 얼마나 강하게 나타나는지를 의미한다.
    - 위치 변화에 덜 민감하다.
        - 객체가 이미지 내에서 약간 움직이거나 형태가 조금 변형되더라도, 맥스풀링은 동일한 특징을 추출할 가능성이 높다.

![맥스풀링](../images/cnn-basics_10.png)

### 스트라이드 합성곱

- 필터를 스트라이드 값만큼 (S칸) 이동한 후 출력값을 계산한다.
    - 일반 합성곱: 필터를 1칸씩 이동하면서 연산을 수행한다. (S = 1)
- 해상도 저하로 인한 정보 손실이 적다.
    - 풀링의 한계를 개선했다.
- **풀링 + 합성곱을 하나의 레이어로** 대체한다.
- 고도화된 CNN에서는 스트라이드 합성곱을 풀링 대신 활용되는 경향이 있다.
