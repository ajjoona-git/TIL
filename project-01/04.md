#  [ê´€í†µ PJT] 4íšŒì°¨ ë„ì „ ê³¼ì œ | ì£¼ì‹ ì •ë³´ í¬ë¡¤ë§ ë° ê²Œì‹œíŒ ì„œë¹„ìŠ¤

## ì½”ë“œ íŒŒì¼ ë³´ëŸ¬ê°€ê¸° â†’ [![GitHub Repository](https://img.shields.io/badge/GitHub-ajjoona--git/pjt--04-yellow?style=flat&logo=github)](https://github.com/ajjoona-git/pjt-04.git)

<aside>
ğŸ’¡ ê¸ˆìœµ | ë°•ì˜ìš´ ë°•ì¤€ì•„
</aside>

### ìš”êµ¬ì‚¬í•­
ì…€ë ˆë‹ˆì›€(Selenium)ì„ í™œìš©í•˜ì—¬ ë™ì  ì›¹ í˜ì´ì§€ì—ì„œ ì£¼ì‹ ì •ë³´ë¥¼ í¬ë¡¤ë§í•˜ê³ , Django í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•´ ì›¹ í˜ì´ì§€ì— ì‹œê°í™”í•˜ë©° ëŒ“ê¸€ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ë‹´ë‹¹ ê¸°ëŠ¥ ë° êµ¬í˜„ í™”ë©´

| êµ¬ë¶„ | ë‚´ìš© |
| --- | --- |
| **í˜ì´ì§€ëª…** | **ë©”ì¸ í˜ì´ì§€ (`crawlings/`)** |
| **ì´ë¯¸ì§€** | ![ë©”ì¸ í˜ì´ì§€ (crawlings/)](../images/pjt-04_8.png) |
| **ì„¤ëª…** | ì£¼ì‹ ì •ë³´ í¬ë¡¤ë§ ë° ëª©ë¡ í‘œì‹œ |

| êµ¬ë¶„ | ë‚´ìš© |
| --- | --- |
| **í˜ì´ì§€ëª…** | **ìƒì„¸ í˜ì´ì§€ (crawlings/detail/<int:pk>/)** |
| **ì´ë¯¸ì§€** | ![ê²€ìƒ‰ í›„ ìƒì„¸ í™”ë©´ (crawlings/detail/10/)](../images/pjt-04_9.png) |
| **ì„¤ëª…** | ìƒì„¸ ì •ë³´ ë° ëŒ“ê¸€ ìƒì„±/ì¡°íšŒ |

| êµ¬ë¶„ | ë‚´ìš© |
| --- | --- |
| **í˜ì´ì§€ëª…** | **ëŒ“ê¸€ ì‚­ì œ ê¸°ëŠ¥ (crawlings/delete/<int:pk>/)** |
| **ì´ë¯¸ì§€** | ![ëŒ“ê¸€ ì‚­ì œ í›„ ìƒì„¸ í™”ë©´ (crawlings/detail/10/)](../images/pjt-04_10.png) |
| **ì„¤ëª…** | íŠ¹ì • ëŒ“ê¸€ ì‚­ì œ í›„ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

## ì£¼ìš” í•´ê²° ê³¼ì • ë° ë°°ìš´ ì 

### 1. Seleniumì„ í™œìš©í•œ ë™ì  í˜ì´ì§€ í¬ë¡¤ë§

```python
# ===== ë“œë¼ì´ë²„ ìƒì„± í•¨ìˆ˜ =====
def get_driver():
    """
    í¬ë¡¬ ë“œë¼ì´ë²„ë¥¼ ì´ˆê¸°í™”í•˜ì—¬ WebDriver ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    - ì˜µì…˜ ë° ê²½ë¡œ ì„¤ì •ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬
    """
    chromedriver_path = Path("chromedriver-win64/chromedriver.exe")
    if not chromedriver_path.exists():
        raise FileNotFoundError(
            "chromedriver-win64/chromedriver.exe íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
        )

    # í¬ë¡¬ ì˜µì…˜ ì„¸íŒ…
    chrome_options = webdriver.ChromeOptions()
    # chrome_options.add_argument("--headless")  # í•„ìš”ì‹œ í™œì„±í™”
    chrome_options.add_argument(
        "user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
        "AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36"
    )
    chrome_options.add_experimental_option(
        "excludeSwitches", ["enable-automation"]
    )
    chrome_options.add_experimental_option("useAutomationExtension", False)
    chrome_options.add_argument("disable-blink-features=AutomationControlled")

    service = Service(executable_path=str(chromedriver_path))
    return webdriver.Chrome(service=service, options=chrome_options)
```

- `chrome_options.add_argument("--headless")` ë¸Œë¼ìš°ì € ì°½ì„ ë„ìš°ì§€ ì•Šê³  í¬ë¡¤ë§ì„ ì§„í–‰í•˜ëŠ” ì˜µì…˜
    - ìº¡ì°¨(CAPTCHA) ì¸ì¦ì´ í•„ìš”í•œ í˜ì´ì§€ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŒì„ í™•ì¸í–ˆë‹¤. ì´ ê²½ìš° í•´ë‹¹ ì˜µì…˜ì„ ì£¼ì„ ì²˜ë¦¬í•˜ê³  ì§ì ‘ ì¸ì¦í•´ì•¼ ì›í•˜ëŠ” í˜ì´ì§€ ì •ë³´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

![ìº¡ì°¨ ì…ë ¥í•˜ì§€ ì•Šì€ ê²½ìš° ì €ì¥ëœ íŒŒì¼ (â€™â€”headlessâ€™ í™œì„±í™” ì‹œ)](../images/pjt-04_1.png)

ìº¡ì°¨ ì…ë ¥í•˜ì§€ ì•Šì€ ê²½ìš° ì €ì¥ëœ íŒŒì¼ (â€™â€”headlessâ€™ í™œì„±í™” ì‹œ)

### 2. í† ìŠ¤ ì˜ˆì œ: 01_toss_practice.py â€” ë©”ì¸ í˜ì´ì§€ ì ‘ì†

```python
# í¬ë¡¬ ë“œë¼ì´ë²„ ì˜µì…˜ ì„¤ì •
chrome_options = Options()
chrome_options.add_argument("--disable-gpu")  # GPU ë¹„í™œì„±í™”
chrome_options.add_argument("--disable-extensions")  # í™•ì¥ í”„ë¡œê·¸ë¨ ë¹„í™œì„±í™”
chrome_options.add_argument("--no-sandbox")  # ìƒŒë“œë°•ìŠ¤ ëª¨ë“œ ë¹„í™œì„±í™”
chrome_options.add_argument(
    "--disable-dev-shm-usage"
)  # /dev/shm ê³µìœ  ë©”ëª¨ë¦¬ ì‚¬ìš© ì œí•œ í•´ì œ
```

- `chrome_options.add_argument("--no-sandbox")` í¬ë¡¬ì˜ ìƒŒë“œë°•ìŠ¤ ë³´ì•ˆ ëª¨ë¸ì„ ë¹„í™œì„±í™”í•œë‹¤.
    - ìƒŒë“œë°•ìŠ¤(Sandbox) ëª¨ë“œ: ì™¸ë¶€ í”„ë¡œê·¸ë¨ì´ë‚˜ ì½”ë“œë¥¼ **ì‹œìŠ¤í…œì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ê³¼ ê²©ë¦¬ëœ, ì œí•œëœ í™˜ê²½ì—ì„œ ì‹¤í–‰**í•˜ëŠ” ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜

### 3. ê²½ë¡œ ì„¤ì • ë¬¸ì œ í•´ê²° (NoSuchDriverException)

![NoSuchDriverException](../images/pjt-04_2.png)

```python
# ì´ì „ í´ë”ì˜ í¬ë¡¬ ë“œë¼ì´ë²„ ê²½ë¡œ (ì˜¤ë¥˜ ë°œìƒ)
# service = Service("../chromedriver-win64/chromedriver.exe")

# í•´ê²° ë°©ë²• 1: ì ˆëŒ€ ê²½ë¡œ ì§€ì •
DRIVER_PATH = Path(__file__).resolve().parent.parent / "chromedriver-win64" / "chromedriver.exe"
service = Service(executable_path=str(DRIVER_PATH))

# í•´ê²° ë°©ë²• 2: ì •í™•í•œ ìƒëŒ€ ê²½ë¡œ ì§€ì •
service = Service("chromedriver-win64\chromedriver.exe")
```
- ë¬¸ì œ ë°œìƒ: chromedriver.exeì˜ ìƒëŒ€ ê²½ë¡œë¥¼ ì˜ëª» ì„¤ì •í•˜ì—¬ NoSuchDriverException ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

- í•´ê²° ë°©ì•ˆ: Path(__file__).resolve()ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë“œë¼ì´ë²„ ê²½ë¡œë¥¼ ì„¤ì •í•˜ê±°ë‚˜, íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ 'ìƒëŒ€ ê²½ë¡œ ë³µì‚¬' ê¸°ëŠ¥ì„ ì´ìš©í•´ ì •í™•í•œ ê²½ë¡œë¥¼ ì…ë ¥í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤.


### 4. CSS ì„ íƒìë¥¼ ì´ìš©í•œ ì •í™•í•œ ìš”ì†Œ ì¶”ì¶œ

![.tw-1r5dc8g0](../images/pjt-04_3.png)

![._1sivumi0](../images/pjt-04_4.png)
- ë¬¸ì œ ë°œìƒ: `soup.select_one(".tw-1r5dc8g0")`ì²˜ëŸ¼ ë‹¨ì¼ í´ë˜ìŠ¤ ì„ íƒì ì‚¬ìš© ì‹œ, ì—¬ëŸ¬ ìš”ì†Œê°€ ë™ì¼í•œ í´ë˜ìŠ¤ë¥¼ ê³µìœ í•˜ì—¬ ì›í•˜ì§€ ì•ŠëŠ” ì •ë³´ê°€ ì¶”ì¶œë˜ì—ˆë‹¤.

- í•´ê²° ë°©ì•ˆ:
1. `soup.select_one(".tw-1r5dc8g0")` : ì²˜ìŒì—ëŠ” â€˜SKí•˜ì´ë‹‰ìŠ¤â€™ì˜ í´ë˜ìŠ¤ë¥¼ ì„ íƒí•¨

    â‡’ ì¶œë ¥ ê²°ê³¼: `/`

    í´ë˜ìŠ¤ ì´ë¦„ì„ ëª¨ë‘ ì„ íƒí•´ë³¸ ê²°ê³¼, ì¢…ëª© ì´ë¦„ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ìš”ì†Œë“¤ì—ë„ ë™ì¼í•œ í´ë˜ìŠ¤ê°€ ì ìš©ë¨ì„ í™•ì¸í–ˆë‹¤. (ìƒê¸° ì´ë¯¸ì§€ ì°¸ê³ )

2. `soup.select_one("._1sivumi0")` : ì¢…ëª© ì´ë¦„ì„ ê°ì‹¸ê³  ìˆëŠ” ë¶€ëª¨ íƒœê·¸ í˜¹ì€ í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ ì ìš©í•¨

    â‡’ ì¶œë ¥ ê²°ê³¼: `SKí•˜ì´ë‹‰ìŠ¤000660336,500ì›ì–´ì œë³´ë‹¤Â -20,000ì›Â (5.6%)`

    í•´ë‹¹ ì¶œë ¥ ê²°ê³¼ì—ì„œ splitì„ í• ê¹Œ ìƒê°í–ˆì§€ë§Œ, ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë¶ˆê°€ëŠ¥í–ˆë‹¤.

3. `soup.select_one("._1sivumi0 .tw-1r5dc8g0")` : ë‘ ê°€ì§€ í´ë˜ìŠ¤ ì„ íƒìë¥¼ ê²°í•©í•¨

    â‡’ ì¶œë ¥ ê²°ê³¼: `SKí•˜ì´ë‹‰ìŠ¤`


### 5. Django - 403 Forbidden ì˜¤ë¥˜ í•´ê²°

![403 Forbidden](../images/pjt-04_5.png)

í•˜ë‚˜ì˜ í˜ì´ì§€ì— `form` (HTTP request method=POST) íƒœê·¸ê°€ 2ê°œ ì´ìƒ ì¡´ì¬í•  ê²½ìš°, ê°ê°ì˜ `form` íƒœê·¸ ë‚´ë¶€ì— `{% csrf_token %}`ì„ ê°œë³„ì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤!

### 6. Django - JSONFieldë¥¼ í™œìš©í•œ ëŒ“ê¸€ ê¸°ëŠ¥ êµ¬í˜„

Django ëª¨ë¸ì—ëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì €ì¥í•˜ëŠ” ListFieldê°€ ì—†ì–´, models.JSONField()ë¥¼ í™œìš©í•˜ì—¬ ëŒ“ê¸€ ëª©ë¡ì„ ì €ì¥í–ˆë‹¤.

![Stocks í´ë˜ìŠ¤ ì˜ˆì‹œ](../images/pjt-04_6.png)

- `comment = models.JSONField()`: ëŒ“ê¸€ë“¤ì„ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì €ì¥í•œë‹¤.

```html
<!-- crawlings/detail.html -->
  {% for comment in stock.comment %}
  <li>
    {{ comment }}
    <form action="{% url "crawlings:delete" stock.pk %}" method="POST">
      {% csrf_token %}
      <input type="hidden" name="comment_index" value="{{ forloop.counter0 }}">
      <input type="submit" value="ì‚­ì œ" name>
    </form>
  </li>
  {% endfor %}
```

- `{{ forloop.counter0 }}` : **0ë¶€í„° ì‹œì‘**í•˜ëŠ” ë£¨í”„ ì¹´ìš´í„°ë¡œ, ë¦¬ìŠ¤íŠ¸ì˜ ì¸ë±ìŠ¤ì™€ ì •í™•íˆ ì¼ì¹˜í•œë‹¤.

```python
def delete(request, pk):
    stock = Stocks.objects.get(pk=pk)
    # ì‚­ì œí•  ëŒ“ê¸€ì˜ ì¸ë±ìŠ¤ë¥¼ ë°›ì•„ ì˜¨ë‹¤.
    index = int(request.POST.get('comment_index'))
    # comment ë¦¬ìŠ¤íŠ¸ì—ì„œ indexì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ì‚­ì œí•œë‹¤.
    del stock.comment[index]
    # ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•œë‹¤.
    stock.save()

    return redirect('crawlings:detail', stock.pk)
```

- ë¦¬ìŠ¤íŠ¸ì´ê¸° ë•Œë¬¸ì— indexë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.


- comment = TextField()ë¡œ ì„¤ì •í–ˆì„ ë•Œ
![comment = TextField()ë¡œ ì„¤ì •í–ˆì„ ë•Œ](../images/pjt-04_7.png)
ê° ë¬¸ìì—´ì„ ìˆœíšŒí•˜ë©´ì„œ ì¶œë ¥í•˜ê¸° ë•Œë¬¸ì— í•œ ê¸€ìì”© ì¶œë ¥ëœë‹¤.